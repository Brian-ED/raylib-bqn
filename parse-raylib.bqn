#!/usr/bin/env bqn
âŸ¨ToFFIâ‹„ParseHeaderâŸ© â† â€¢Import "../c-header-to-bqn-ffi/parse.bqn"
headerPathsâ†("/usr/local/include/"âŠ£Â´â€¢args)âŠ¸âˆ¾Â¨"raylib.h"â€¿"rlgl.h"â€¿"raymath.h"
badFunctions â† "rlEnableStatePointer"â€¿"rlDisableStatePointer"
outFile â† "output-raylib.bqn"
renames â† [
  "RL_ZERO"â€¿"RLGL_VERSION" â€¿    "_Bool"
  "RLZERO" â€¿"RLGLVersionString"â€¿"bool"
]
prefixes â† 2â€¿1/âŸ¨
  "/* Functions defined as 'extern' by default (implicit specifiers)*/"
  "inline /* Functions may be inlined or external definition used*/"
âŸ©

# Parsing defines because they're removed in the later macro-resolution stage
defines â† âˆ¾Â´âŠ‘Â¨prefixes ParseHeaderÂ¨ â€¢FCharsÂ¨ headerPaths

macrosResolved â† {ğ•Š:
  errâ€¿outâ€¿errMsgâ†â€¢SH"zig"â€¿"cc"â€¿"-fkeep-system-includes"â€¿"-E"â€¿"-CC"â€¿ğ•©
  errMsg!Â¬err
  out
}Â¨headerPaths
#         /Â¯Â¯Â¯Â¯filter bad funcsÂ¯Â¯Â¯Â¯Â¯\ /Â¯Â¯Â¯Â¯Mash all parsed data togetherÂ¯Â¯Â¯Â¯\
ffiData â† (Â¬badFunctionsâˆŠËœâŠ‘Â¨)âŠ¸/âŒ¾(5âŠ¸âŠ‘) âˆ¾Â¨Â´prefixes ParseHeaderÂ¨ macrosResolved
#                   /Â¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯Filter dupe namesÂ¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯Â¯\ /Â¯Add back the removed defines
ffi â† renames ToFFI (âˆŠâŠ‘Â¨)âŠ¸/âŒ¾âŠ‘ (âˆŠâŠ‘Â¨)âŠ¸/âŒ¾(1âŠ¸âŠ‘) (âˆŠ1âŠ¸âŠ‘Â¨)âŠ¸/âŒ¾(2âŠ¸âŠ‘) (DefinesâŸ¨âŸ©â¼)âŒ¾âŠ‘ a

outFile â€¢FChars ffi
â€¢Out outFileâˆ¾" successfully generated"
